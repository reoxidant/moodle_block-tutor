define(["jquery","core/ajax","core/custom_interaction_events","core/templates","core/notification","block_tutor/selectors","block_tutor/ajax_repository"],function(t,e,o,n,i,a,c){var r=function(t){t.find(a.containers.loadingIcon).removeClass("hidden")},u=function(t){t.find(a.containers.loadingIcon).addClass("hidden")};let l=function(t,e,o){return c.getContentData(t,e,o).done(function(){return u(t)}).fail(i.exception)};return{tabStudentList:function(e,o=null,n="block_tutor/main"){return e.on("show.bs.dropdown",a.tabSelector.dropDownButton,function(o){let n=t(o.currentTarget).find(".dropdown-menu").height();t(e).find(".full-width").height(n)}),e.on("hide.bs.dropdown",a.tabSelector.dropDownButton,function(o){t(e).find(".full-width").css("height","auto")}),e.on("click",a.tabSelector.groupListDropDown,function(o){setTimeout(function(){let o=e.find(a.tabSelector.activeItemGroup)[0].dataset.group;e=t(".block-tutor"),t.ajax({type:"POST",data:{selectList:"grouplist",groupId:o},url:location.origin+"/blocks/tutor/ajax.php",dataType:"html",success:function(e){t(a.tabSelector.content).html(e)},beforeSend:function(){r(e)},complete:function(){u(e)},cache:"false",error:function(){i.addNotification({message:"Ошибка при вызове группы, похоже такого преподавателя несуществует",type:"error"})}})},500)}),e.on("click",a.tabSelector.studentListDropDown,function(o){r(e),setTimeout(function(){let o=e.find(a.tabSelector.activeItemStudent)[0].dataset.student;e=t(".block-tutor"),t.ajax({type:"POST",data:{selectList:"studentlist",studentId:o},url:location.origin+"/blocks/tutor/ajax.php",dataType:"html",success:function(e){t(a.tabSelector.content).html(e)},beforeSend:function(){r(e)},complete:function(){u(e)},cache:"false",error:function(){i.addNotification({message:"Ошибка при выборе студента, похоже такого студента несуществует",type:"error"})}})},500)}),c.getContentData(e,o).fail(i.exception)},registerEventListeners:function(e,n=null,i="block_tutor/main"){e=t(e),u(e),e.on(o.events.activate,"[data-toggle='tab']",function(o){r(e);let i=t(o.currentTarget).data("tabname");return"studentlist"===n?n="block_tutor_studentlist_tab":(n="block_tutor_last_tab","function"==typeof window.history.pushState&&window.history.pushState(null,null,"?tutortab="+i)),l(e,n,i)})}}});